<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="GathunguGeoConsult - GIS and Geomatics services">
    <meta name="robots" content="index, follow">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'; img-src 'self' https://via.placeholder.com; form-action 'self';">
    <title>GathunguGeoConsult</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            color: #333;
        }
        header {
            background-color: #1976D2;
            color: white;
            padding: 1em;
            text-align: center;
        }
        nav {
            background-color: #FBC02D;
            padding: 1em;
        }
        nav a {
            color: #333;
            margin: 0 1em;
            text-decoration: none;
            cursor: pointer;
        }
        nav a:hover {
            text-decoration: underline;
        }
        .search-bar {
            padding: 1em;
            background-color: #f4f4f4;
            text-align: center;
        }
        .search-bar input {
            padding: 0.5em;
            width: 50%;
            max-width: 500px;
            border: 1px solid #ddd;
        }
        .content, .services, .request-form, .faq {
            padding: 2em;
            max-width: 800px;
            margin: 0 auto;
            display: none;
        }
        .active {
            display: block;
        }
        .service-item {
            border: 1px solid #ddd;
            padding: 1em;
            margin: 1em 0;
            background-color: #fff;
        }
        .service-item h3 {
            color: #4CAF50;
        }
        .price {
            color: #D32F2F;
        }
        .request-form form {
            display: flex;
            flex-direction: column;
            gap: 1em;
            max-width: 500px;
        }
        .request-form input, .request-form select {
            padding: 0.5em;
            border: 1px solid #ddd;
        }
        .request-form button {
            background-color: #FBC02D;
            color: #333;
            padding: 0.5em;
            border: none;
            cursor: pointer;
        }
        .request-form button:hover {
            background-color: #e6b000;
        }
        .faq h2, .request-form h2, .services h2, .content h2 {
            color: #1976D2;
        }
        .survey-img {
            width: 100%;
            max-width: 600px;
            margin: 1em auto;
            display: block;
        }
        #confirmation {
            display: none;
            color: #4CAF50;
            text-align: center;
            padding: 1em;
        }
        .error {
            color: #D32F2F;
            text-align: center;
            padding: 1em;
            display: none;
        }
        #adminSection, #adminContent {
            display: none;
            padding: 2em;
            max-width: 600px;
            margin: 0 auto;
        }
        #adminSection form, #adminContent form {
            display: flex;
            flex-direction: column;
            gap: 1em;
        }
        #adminSection input, #adminContent input, #adminContent textarea {
            padding: 0.5em;
            border: 1px solid #ddd;
        }
        #adminSection button, #adminContent button {
            background-color: #FBC02D;
            color: #333;
            padding: 0.5em;
            border: none;
            cursor: pointer;
        }
        #adminSection button:hover, #adminContent button:hover {
            background-color: #e6b000;
        }
        .service-item button, .request-item button {
            background-color: #D32F2F;
            color: white;
            margin: 0.2em;
            padding: 0.3em 0.6em;
        }
        .service-item .edit-button {
            background-color: #1976D2;
        }
        .service-item button:hover, .request-item button:hover {
            background-color: #b71c1c;
        }
        .service-item .edit-button:hover {
            background-color: #1565C0;
        }
        .service-list, .request-list {
            margin: 1em 0;
        }
        .service-item, .request-item {
            border: 1px solid #ddd;
            padding: 1em;
            margin: 0.5em 0;
        }
        footer {
            background-color: #1976D2;
            color: white;
            text-align: center;
            padding: 1em;
            position: relative;
            bottom: 0;
            width: 100%;
        }
        .contact-info, .mission-statement {
            margin: 1em 0;
            text-align: center;
        }
        .contact-info p, .mission-statement p {
            margin: 0.5em 0;
        }
        #editServiceForm {
            display: none;
            margin-top: 1em;
        }
    </style>
</head>
<body>
    <header>
        <h1>GathunguGeoConsult</h1>
    </header>
    <nav>
        <a onclick="showSection('home')">Home</a>
        <a onclick="showSection('services')">Our Services</a>
        <a onclick="showSection('request')">Request a Service</a>
        <a onclick="showSection('faq')">Frequently Asked Questions</a>
    </nav>
    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Search for services..." onkeyup="searchServices()">
    </div>

    <section id="home" class="content active">
        <h2>Home</h2>
        <p>Welcome to GathunguGeoConsult! We provide professional GIS and Geomatics services to help you map, analyze, and manage your land and spatial data. Explore our services, request a consultation, or learn more through our FAQ.</p>
        <img src="https://via.placeholder.com/600x400?text=Surveyor+Using+Equipment" alt="Surveyor with equipment" class="survey-img">
        <div class="mission-statement">
            <h3>Our Mission</h3>
            <p>To deliver accurate, reliable, and innovative geospatial solutions that empower our clients to make informed decisions about their land and resources.</p>
        </div>
        <div class="contact-info">
            <h3>Contact Us</h3>
            <p>Phone: +254 752 395 690</p>
            <p>Email: info@gathungugeoconsult.co.ke</p>
            <p>Address: Nairobi, Kenya</p>
        </div>
    </section>

    <section id="services" class="services">
        <h2>Our Services</h2>
        <div id="serviceList">
            <div class="service-item">
                <h3>Topographic Survey</h3>
                <p>Accurate mapping of land features and elevation for planning and construction.</p>
                <p class="price">Price Range: Ksh 5,000 - 10,000</p>
            </div>
            <div class="service-item">
                <h3>Land Parcel Mapping</h3>
                <p>Precise boundary delineation for property ownership and development.</p>
                <p class="price">Price Range: Ksh 8,000 - 15,000</p>
            </div>
            <div class="service-item">
                <h3>GIS Data Analysis</h3>
                <p>Spatial data processing and visualization for informed decision-making.</p>
                <p class="price">Price Range: Ksh 10,000 - 20,000</p>
            </div>
            <div class="service-item">
                <h3>Cadastral Surveying</h3>
                <p>Establishing legal land boundaries for registration and titling.</p>
                <p class="price">Price Range: Ksh 12,000 - 25,000</p>
            </div>
            <div class="service-item">
                <h3>Remote Sensing</h3>
                <p>Collecting and analyzing data from satellite or aerial imagery.</p>
                <p class="price">Price Range: Ksh 15,000 - 30,000</p>
            </div>
            <div class="service-item">
                <h3>Geospatial Database Development</h3>
                <p>Creating and managing databases for spatial data storage and querying.</p>
                <p class="price">Price Range: Ksh 20,000 - 40,000</p>
            </div>
            <div class="service-item">
                <h3>3D Terrain Modeling</h3>
                <p>Generating 3D models of terrain for visualization and analysis.</p>
                <p class="price">Price Range: Ksh 18,000 - 35,000</p>
            </div>
            <div class="service-item">
                <h3>Hydrographic Surveying</h3>
                <p>Mapping water bodies and underwater features for navigation or engineering.</p>
                <p class="price">Price Range: Ksh 25,000 - 50,000</p>
            </div>
            <div class="service-item">
                <h3>Urban Planning Support</h3>
                <p>Providing GIS data for city planning, zoning, and infrastructure design.</p>
                <p class="price">Price Range: Ksh 15,000 - 35,000</p>
            </div>
            <div class="service-item">
                <h3>Environmental Mapping</h3>
                <p>Assessing and mapping environmental features for conservation and impact studies.</p>
                <p class="price">Price Range: Ksh 10,000 - 25,000</p>
            </div>
            <div class="service-item">
                <h3>Geodetic Surveying</h3>
                <p>Precise measurements for earth’s shape and gravity field applications.</p>
                <p class="price">Price Range: Ksh 20,000 - 45,000</p>
            </div>
            <div class="service-item">
                <h3>Cartographic Services</h3>
                <p>Designing and producing custom maps for various purposes.</p>
                <p class="price">Price Range: Ksh 8,000 - 20,000</p>
            </div>
            <div class="service-item">
                <h3>Land Use Planning</h3>
                <p>Analyzing and mapping land use for sustainable development.</p>
                <p class="price">Price Range: Ksh 12,000 - 30,000</p>
            </div>
            <div class="service-item">
                <h3>Construction Surveying</h3>
                <p>Staking out and monitoring construction sites for accuracy.</p>
                <p class="price">Price Range: Ksh 15,000 - 35,000</p>
            </div>
            <div class="service-item">
                <h3>Photogrammetry</h3>
                <p>Deriving measurements and 3D models from photographs.</p>
                <p class="price">Price Range: Ksh 20,000 - 40,000</p>
            </div>
        </div>
        <div id="error" class="error">Unable to load services. Please try again later.</div>
        <img src="https://via.placeholder.com/600x400?text=Surveyor+Using+Equipment" alt="Surveyor with equipment" class="survey-img">
    </section>

    <section id="request" class="request-form">
        <h2>Request a Service</h2>
        <form id="serviceRequestForm" onsubmit="submitRequest(event)">
            <label for="serviceType">Service Needed:</label>
            <select id="serviceType" name="serviceType" required>
                <option value="">Select a service</option>
                <option value="Topographic Survey">Topographic Survey</option>
                <option value="Land Parcel Mapping">Land Parcel Mapping</option>
                <option value="GIS Data Analysis">GIS Data Analysis</option>
                <option value="Cadastral Surveying">Cadastral Surveying</option>
                <option value="Remote Sensing">Remote Sensing</option>
                <option value="Geospatial Database Development">Geospatial Database Development</option>
                <option value="3D Terrain Modeling">3D Terrain Modeling</option>
                <option value="Hydrographic Surveying">Hydrographic Surveying</option>
                <option value="Urban Planning Support">Urban Planning Support</option>
                <option value="Environmental Mapping">Environmental Mapping</option>
                <option value="Geodetic Surveying">Geodetic Surveying</option>
                <option value="Cartographic Services">Cartographic Services</option>
                <option value="Land Use Planning">Land Use Planning</option>
                <option value="Construction Surveying">Construction Surveying</option>
                <option value="Photogrammetry">Photogrammetry</option>
                <option value="Other">Other</option>
            </select>
            <label for="customService">If Other, specify:</label>
            <input type="text" id="customService" name="customService">
            <label for="phone">Mobile Phone Number:</label>
            <input type="tel" id="phone" name="phone" pattern="[0-9]{10}" placeholder="e.g., 0712345678" required>
            <button type="submit">Submit Request</button>
        </form>
        <div id="confirmation">Thank you! Your request has been received.</div>
    </section>

    <section id="faq" class="faq">
        <h2>Frequently Asked Questions</h2>
        <div>
            <h3>What is a topographic survey?</h3>
            <p>A topographic survey maps the elevation and features of a piece of land, useful for construction and planning.</p>
        </div>
        <div>
            <h3>How long does a service take?</h3>
            <p>Duration varies by project size and complexity, typically 2-5 days. We’ll confirm after your request.</p>
        </div>
        <div>
            <h3>Do I need an account to request a service?</h3>
            <p>No, simply fill out the request form with your service choice and phone number.</p>
        </div>
        <div>
            <h3>Why do I need a survey for my property?</h3>
            <p>A survey clarifies your property boundaries, prevents disputes with neighbors, and is often required for legal documents or construction permits.</p>
        </div>
        <div>
            <h3>What happens if my land boundaries are unclear?</h3>
            <p>Unclear boundaries can lead to disputes or legal issues. Our cadastral or land parcel mapping services can define and register your boundaries accurately.</p>
        </div>
        <div>
            <h3>Can you help me understand if my land is suitable for building?</h3>
            <p>Yes, our topographic and environmental mapping services assess land features, elevation, and environmental factors to determine suitability for construction.</p>
        </div>
        <div>
            <h3>How do I know which service I need?</h3>
            <p>Contact us via the request form with your needs, and we’ll guide you to the right service, whether it’s for boundary mapping, construction, or planning.</p>
        </div>
        <div>
            <h3>What equipment do you use for surveys?</h3>
            <p>We use advanced tools like GPS, total stations, drones, and satellite imagery to ensure accurate and efficient results.</p>
        </div>
        <div>
            <h3>Will I get a map or report after the service?</h3>
            <p>Yes, depending on the service, you’ll receive detailed maps, reports, or digital data (e.g., GIS files or 3D models) tailored to your needs.</p>
        </div>
        <div>
            <h3>Can you survey land in remote areas?</h3>
            <p>Yes, our team is equipped to handle surveys in remote locations using remote sensing and portable surveying tools.</p>
        </div>
        <div>
            <h3>How accurate are your surveys?</h3>
            <p>Our surveys are highly accurate, using precise instruments and methods, with accuracy levels suitable for legal, construction, or planning purposes.</p>
        </div>
        <div>
            <h3>Do I need to be present during the survey?</h3>
            <p>Not always, but it’s helpful for you to clarify boundaries or specific needs. We’ll coordinate with you beforehand.</p>
        </div>
        <div>
            <h3>Can your services help with land disputes?</h3>
            <p>Yes, our cadastral and land parcel mapping services provide clear boundary definitions to help resolve or prevent disputes.</p>
        </div>
    </section>

    <section id="adminSection">
        <h2>Admin Login</h2>
        <form onsubmit="adminLogin(event)">
            <label for="username">Username:</label>
            <input type="text" id="username" name="username" required>
            <label for="password">Password:</label>
            <input type="password" id="password" name="password" required>
            <button type="submit">Login</button>
        </form>
        <div id="accessError" class="error">Access restricted. Please contact the owner for the admin URL.</div>
    </section>

    <section id="adminContent">
        <h2>Manage Services</h2>
        <form id="addServiceForm" onsubmit="addService(event)">
            <label for="serviceName">Service Name:</label>
            <input type="text" id="serviceName" name="serviceName" required>
            <label for="serviceDesc">Description:</label>
            <textarea id="serviceDesc" name="serviceDesc" required></textarea>
            <label for="priceRange">Price Range (e.g., Ksh 5,000 - 10,000):</label>
            <input type="text" id="priceRange" name="priceRange" required>
            <button type="submit">Add Service</button>
        </form>
        <form id="editServiceForm" onsubmit="updateService(event)">
            <input type="hidden" id="editServiceId" name="serviceId">
            <label for="editServiceName">Service Name:</label>
            <input type="text" id="editServiceName" name="serviceName" required>
            <label for="editServiceDesc">Description:</label>
            <textarea id="editServiceDesc" name="serviceDesc" required></textarea>
            <label for="editPriceRange">Price Range (e.g., Ksh 5,000 - 10,000):</label>
            <input type="text" id="editPriceRange" name="priceRange" required>
            <button type="submit">Update Service</button>
            <button type="button" onclick="cancelEdit()">Cancel</button>
        </form>
        <div class="service-list" id="adminServiceList">
            <div class="service-item" data-id="1">
                <h3>Topographic Survey</h3>
                <p>Accurate mapping of land features and elevation.</p>
                <p>Price Range: Ksh 5,000 - 10,000</p>
                <button class="edit-button" onclick="editService(1, 'Topographic Survey', 'Accurate mapping of land features and elevation.', 'Ksh 5,000 - 10,000')">Edit</button>
                <button onclick="deleteService(1)">Delete</button>
            </div>
            <div class="service-item" data-id="2">
                <h3>Land Parcel Mapping</h3>
                <p>Precise boundary delineation for property.</p>
                <p>Price Range: Ksh 8,000 - 15,000</p>
                <button class="edit-button" onclick="editService(2, 'Land Parcel Mapping', 'Precise boundary delineation for property.', 'Ksh 8,000 - 15,000')">Edit</button>
                <button onclick="deleteService(2)">Delete</button>
            </div>
            <div class="service-item" data-id="3">
                <h3>GIS Data Analysis</h3>
                <p>Spatial data processing and visualization.</p>
                <p>Price Range: Ksh 10,000 - 20,000</p>
                <button class="edit-button" onclick="editService(3, 'GIS Data Analysis', 'Spatial data processing and visualization.', 'Ksh 10,000 - 20,000')">Edit</button>
                <button onclick="deleteService(3)">Delete</button>
            </div>
            <div class="service-item" data-id="4">
                <h3>Cadastral Surveying</h3>
                <p>Establishing legal land boundaries for registration and titling.</p>
                <p>Price Range: Ksh 12,000 - 25,000</p>
                <button class="edit-button" onclick="editService(4, 'Cadastral Surveying', 'Establishing legal land boundaries for registration and titling.', 'Ksh 12,000 - 25,000')">Edit</button>
                <button onclick="deleteService(4)">Delete</button>
            </div>
            <div class="service-item" data-id="5">
                <h3>Remote Sensing</h3>
                <p>Collecting and analyzing data from satellite or aerial imagery.</p>
                <p>Price Range: Ksh 15,000 - 30,000</p>
                <button class="edit-button" onclick="editService(5, 'Remote Sensing', 'Collecting and analyzing data from satellite or aerial imagery.', 'Ksh 15,000 - 30,000')">Edit</button>
                <button onclick="deleteService(5)">Delete</button>
            </div>
            <div class="service-item" data-id="6">
                <h3>Geospatial Database Development</h3>
                <p>Creating and managing databases for spatial data storage and querying.</p>
                <p>Price Range: Ksh 20,000 - 40,000</p>
                <button class="edit-button" onclick="editService(6, 'Geospatial Database Development', 'Creating and managing databases for spatial data storage and querying.', 'Ksh 20,000 - 40,000')">Edit</button>
                <button onclick="deleteService(6)">Delete</button>
            </div>
            <div class="service-item" data-id="7">
                <h3>3D Terrain Modeling</h3>
                <p>Generating 3D models of terrain for visualization and analysis.</p>
                <p>Price Range: Ksh 18,000 - 35,000</p>
                <button class="edit-button" onclick="editService(7, '3D Terrain Modeling', 'Generating 3D models of terrain for visualization and analysis.', 'Ksh 18,000 - 35,000')">Edit</button>
                <button onclick="deleteService(7)">Delete</button>
            </div>
            <div class="service-item" data-id="8">
                <h3>Hydrographic Surveying</h3>
                <p>Mapping water bodies and underwater features for navigation or engineering.</p>
                <p>Price Range: Ksh 25,000 - 50,000</p>
                <button class="edit-button" onclick="editService(8, 'Hydrographic Surveying', 'Mapping water bodies and underwater features for navigation or engineering.', 'Ksh 25,000 - 50,000')">Edit</button>
                <button onclick="deleteService(8)">Delete</button>
            </div>
            <div class="service-item" data-id="9">
                <h3>Urban Planning Support</h3>
                <p>Providing GIS data for city planning, zoning, and infrastructure design.</p>
                <p>Price Range: Ksh 15,000 - 35,000</p>
                <button class="edit-button" onclick="editService(9, 'Urban Planning Support', 'Providing GIS data for city planning, zoning, and infrastructure design.', 'Ksh 15,000 - 35,000')">Edit</button>
                <button onclick="deleteService(9)">Delete</button>
            </div>
            <div class="service-item" data-id="10">
                <h3>Environmental Mapping</h3>
                <p>Assessing and mapping environmental features for conservation and impact studies.</p>
                <p>Price Range: Ksh 10,000 - 25,000</p>
                <button class="edit-button" onclick="editService(10, 'Environmental Mapping', 'Assessing and mapping environmental features for conservation and impact studies.', 'Ksh 10,000 - 25,000')">Edit</button>
                <button onclick="deleteService(10)">Delete</button>
            </div>
            <div class="service-item" data-id="11">
                <h3>Geodetic Surveying</h3>
                <p>Precise measurements for earth’s shape and gravity field applications.</p>
                <p>Price Range: Ksh 20,000 - 45,000</p>
                <button class="edit-button" onclick="editService(11, 'Geodetic Surveying', 'Precise measurements for earth’s shape and gravity field applications.', 'Ksh 20,000 - 45,000')">Edit</button>
                <button onclick="deleteService(11)">Delete</button>
            </div>
            <div class="service-item" data-id="12">
                <h3>Cartographic Services</h3>
                <p>Designing and producing custom maps for various purposes.</p>
                <p>Price Range: Ksh 8,000 - 20,000</p>
                <button class="edit-button" onclick="editService(12, 'Cartographic Services', 'Designing and producing custom maps for various purposes.', 'Ksh 8,000 - 20,000')">Edit</button>
                <button onclick="deleteService(12)">Delete</button>
            </div>
            <div class="service-item" data-id="13">
                <h3>Land Use Planning</h3>
                <p>Analyzing and mapping land use for sustainable development.</p>
                <p>Price Range: Ksh 12,000 - 30,000</p>
                <button class="edit-button" onclick="editService(13, 'Land Use Planning', 'Analyzing and mapping land use for sustainable development.', 'Ksh 12,000 - 30,000')">Edit</button>
                <button onclick="deleteService(13)">Delete</button>
            </div>
            <div class="service-item" data-id="14">
                <h3>Construction Surveying</h3>
                <p>Staking out and monitoring construction sites for accuracy.</p>
                <p>Price Range: Ksh 15,000 - 35,000</p>
                <button class="edit-button" onclick="editService(14, 'Construction Surveying', 'Staking out and monitoring construction sites for accuracy.', 'Ksh 15,000 - 35,000')">Edit</button>
                <button onclick="deleteService(14)">Delete</button>
            </div>
            <div class="service-item" data-id="15">
                <h3>Photogrammetry</h3>
                <p>Deriving measurements and 3D models from photographs.</p>
                <p>Price Range: Ksh 20,000 - 40,000</p>
                <button class="edit-button" onclick="editService(15, 'Photogrammetry', 'Deriving measurements and 3D models from photographs.', 'Ksh 20,000 - 40,000')">Edit</button>
                <button onclick="deleteService(15)">Delete</button>
            </div>
        </div>
        <h2>Customer Requests</h2>
        <div class="request-list" id="requestList">
            <div class="request-item" data-id="1">
                <p><strong>Service:</strong> Topographic Survey</p>
                <p><strong>Phone:</strong> 0712345678</p>
                <button onclick="deleteRequest(1)">Delete</button>
            </div>
        </div>
    </section>

    <footer>
        <p>© 2025 GathunguGeoConsult. All rights reserved.</p>
    </footer>

    <script>
        const validAccessKey = 'gathungu-secret-2025';
        window.onload = function() {
            const params = new URLSearchParams(window.location.search);
            const accessKey = params.get('key');
            if (accessKey === validAccessKey) {
                document.getElementById('adminSection').style.display = 'block';
            } else {
                document.getElementById('adminSection').style.display = 'none';
                document.getElementById('accessError').style.display = 'block';
            }
            showSection('home');
        }

        function showSection(sectionId) {
            const sections = ['home', 'services', 'request', 'faq', 'adminSection', 'adminContent'];
            sections.forEach(id => {
                const section = document.getElementById(id);
                if (section) {
                    section.classList.remove('active');
                    if (id === sectionId) {
                        section.classList.add('active');
                    }
                }
            });
            if (sectionId === 'services') {
                const params = new URLSearchParams(window.location.search);
                const search = params.get('search');
                if (search) {
                    document.getElementById('searchInput').value = search;
                    searchServices();
                }
                const serviceList = document.getElementById('serviceList').children;
                if (serviceList.length === 0) {
                    document.getElementById('error').style.display = 'block';
                } else {
                    document.getElementById('error').style.display = 'none';
                }
            }
        }

        function searchServices() {
            const input = document.getElementById('searchInput').value.toLowerCase();
            const services = document.getElementById('serviceList').getElementsByClassName('service-item');
            let hasMatch = false;
            for (let i = 0; i < services.length; i++) {
                const title = services[i].getElementsByTagName('h3')[0].textContent.toLowerCase();
                const desc = services[i].getElementsByTagName('p')[0].textContent.toLowerCase();
                if (title.includes(input) || desc.includes(input)) {
                    services[i].style.display = 'block';
                    hasMatch = true;
                } else {
                    services[i].style.display = 'none';
                }
            }
            document.getElementById('error').style.display = hasMatch ? 'none' : 'block';
        }

        function submitRequest(event) {
            event.preventDefault();
            const service = document.getElementById('serviceType').value;
            const customService = document.getElementById('customService').value;
            const phone = document.getElementById('phone').value;
            
            if (!service || !phone.match(/^[0-9]{10}$/)) {
                alert('Please select a service and enter a valid 10-digit phone number.');
                return;
            }
            
            const requestData = { service: service === 'Other' ? customService : service, phone };
            console.log('Request:', requestData);
            fetch('/api/request', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-Token': generateCsrfToken()
                },
                body: JSON.stringify(requestData)
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('confirmation').style.display = 'block';
                document.getElementById('serviceRequestForm').reset();
                setTimeout(() => {
                    document.getElementById('confirmation').style.display = 'none';
                }, 3000);
            })
            .catch(error => {
                alert('Error submitting request. Please try again.');
                console.error('Error:', error);
            });
        }

        function adminLogin(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            fetch('/api/admin/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-Token': generateCsrfToken()
                },
                body: JSON.stringify({ username, password })
            })
            .then(response => response.json())
            .then(data => {
                if (data.message === 'Login successful') {
                    document.getElementById('adminSection').style.display = 'none';
                    document.getElementById('adminContent').style.display = 'block';
                } else {
                    alert('Invalid username or password');
                }
            })
            .catch(error => {
                alert('Error during login. Please try again.');
                console.error('Error:', error);
            });
        }

        function addService(event) {
            event.preventDefault();
            const name = document.getElementById('serviceName').value;
            const desc = document.getElementById('serviceDesc').value;
            const price = document.getElementById('priceRange').value;
            const id = Date.now();
            
            fetch('/api/admin/services', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-Token': generateCsrfToken()
                },
                body: JSON.stringify({ name, description: desc, priceRange: price })
            })
            .then(response => response.json())
            .then(data => {
                const serviceList = document.getElementById('adminServiceList');
                const newService = document.createElement('div');
                newService.className = 'service-item';
                newService.dataset.id = id;
                newService.innerHTML = `
                    <h3>${sanitizeInput(name)}</h3>
                    <p>${sanitizeInput(desc)}</p>
                    <p>Price Range: ${sanitizeInput(price)}</p>
                    <button class="edit-button" onclick="editService(${id}, '${sanitizeInput(name)}', '${sanitizeInput(desc)}', '${sanitizeInput(price)}')">Edit</button>
                    <button onclick="deleteService(${id})">Delete</button>
                `;
                serviceList.appendChild(newService);
                document.getElementById('addServiceForm').reset();
                console.log('New Service:', { id, name, desc, price });
            })
            .catch(error => {
                alert('Error adding service. Please try again.');
                console.error('Error:', error);
            });
        }

        function editService(id, name, desc, price) {
            document.getElementById('editServiceId').value = id;
            document.getElementById('editServiceName').value = name;
            document.getElementById('editServiceDesc').value = desc;
            document.getElementById('editPriceRange').value = price;
            document.getElementById('editServiceForm').style.display = 'block';
            document.getElementById('addServiceForm').style.display = 'none';
        }

        function updateService(event) {
            event.preventDefault();
            const id = document.getElementById('editServiceId').value;
            const name = document.getElementById('editServiceName').value;
            const desc = document.getElementById('editServiceDesc').value;
            const price = document.getElementById('editPriceRange').value;
            
            fetch(`/api/admin/services/${id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-Token': generateCsrfToken()
                },
                body: JSON.stringify({ name, description: desc, priceRange: price })
            })
            .then(response => response.json())
            .then(data => {
                const service = document.querySelector(`.service-item[data-id="${id}"]`);
                if (service) {
                    service.innerHTML = `
                        <h3>${sanitizeInput(name)}</h3>
                        <p>${sanitizeInput(desc)}</p>
                        <p>Price Range: ${sanitizeInput(price)}</p>
                        <button class="edit-button" onclick="editService(${id}, '${sanitizeInput(name)}', '${sanitizeInput(desc)}', '${sanitizeInput(price)}')">Edit</button>
                        <button onclick="deleteService(${id})">Delete</button>
                    `;
                }
                cancelEdit();
                console.log('Updated Service:', { id, name, desc, price });
            })
            .catch(error => {
                alert('Error updating service. Please try again.');
                console.error('Error:', error);
            });
        }

        function cancelEdit() {
            document.getElementById('editServiceForm').style.display = 'none';
            document.getElementById('addServiceForm').style.display = 'block';
            document.getElementById('editServiceForm').reset();
        }

        function deleteService(id) {
            fetch(`/api/admin/services/${id}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-Token': generateCsrfToken()
                }
            })
            .then(response => response.json())
            .then(data => {
                const service = document.querySelector(`.service-item[data-id="${id}"]`);
                if (service) {
                    service.remove();
                    console.log('Deleted Service ID:', id);
                }
            })
            .catch(error => {
                alert('Error deleting service. Please try again.');
                console.error('Error:', error);
            });
        }

        function deleteRequest(id) {
            fetch(`/api/admin/requests/${id}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-Token': generateCsrfToken()
                }
            })
            .then(response => response.json())
            .then(data => {
                const request = document.querySelector(`.request-item[data-id="${id}"]`);
                if (request) {
                    request.remove();
                    console.log('Deleted Request ID:', id);
                }
            })
            .catch(error => {
                alert('Error deleting request. Please try again.');
                console.error('Error:', error);
            });
        }

        function sanitizeInput(input) {
            const div = document.createElement('div');
            div.textContent = input;
            return div.innerHTML;
        }

        function generateCsrfToken() {
            return 'csrf-token-' + Math.random().toString(36).substr(2, 9);
        }
    </script>
</body>
</html>
